#!/usr/local/bin/perl -w

use strict;
require ExtUtils::MakeMaker;
require Config;

my $DRIVER = "~DRIVER~";

sub ~DRIVER~_config () {
    my $ref = _MY::Config::Initialize~DRIVER~();
    my %hash = %$ref;
    $hash{NAME} = $DRIVER;
    $hash{VERSION} = "~NODBD_VERSION~";
    $hash{OBJECT} = '$(O_FILES)';
    $hash{EXE_FILES} = [ ($DRIVER eq 'Msql') ? 'pmsql' : 'pmysql' ];
    \%hash;
}

ExtUtils::MakeMaker::WriteMakefile(CONFIGURE => \&~DRIVER~_config);

sub MY::postamble {
    my $pa = "\n";
    my $ref;
    foreach $ref (@_MY::Config::Files::~DRIVER~,
		  ["../nodbd/constants.c", "constants.c"],
		  ["../dbd/myMsql.c", "myMsql.c"],
		  ["../nodbd/nodbd.xs.in", "~DRIVER~.xs"],
		  ["../nodbd/pmsql.in", "pmsql"],
		  ["../nodbd/typemap", "typemap"],
		  ["../tests/lib.pl", "t/lib.pl"],
		  ["../tests/msql1.t", "t/msql1.t"],
		  ["../tests/msql2.t", "t/msql2.t"],
		  ["../tests/akmisc.t", "t/akmisc.t"]) {
	my($from, $to) = @$ref;
	$pa .= sprintf("%s: %s Makefile.PL\n"
		       . "\tperl ../xtract %s %s %s %s %s %s\n\n",
		       $to, $from, $from, $to, "~DRIVER~", "~DBD_DRIVER~",
		       "~NODBD_VERSION~", "~DBD_VERSION~");
    }
    $pa;
}

