# -*- perl -*-

use strict;
require ExtUtils::MakeMaker;
require Config;
use lib "..";
require "Makefile.lib";

_MY::Config::Init(0);

my $DRIVER = "~DRIVER~";

sub ~DRIVER~_config () {
    my $ref = _MY::Config::Initialize~DRIVER~();
    my %hash = %$ref;
    $hash{NAME} = $DRIVER;
    $hash{VERSION} = "~NODBD_VERSION~";
    $hash{OBJECT} = '$(O_FILES)';
    $hash{EXE_FILES} = [ ($DRIVER eq 'Msql') ? 'pmsql' : 'pmysql' ];
    \%hash;
}

ExtUtils::MakeMaker::WriteMakefile(CONFIGURE => \&~DRIVER~_config);

sub MY::postamble {
    my $pa = "\n";
    my $ref;
    foreach $ref (@_MY::Config::Files::~DRIVER~,
		  ["../dbd/myMsql.c", "myMsql.c"],
		  ["../nodbd/nodbd.xs.in", "~DRIVER~.xs"],
		  ["../nodbd/pmsql.in", "pmsql", 1],
		  ["../nodbd/typemap", "typemap"],
		  ["../tests/lib.pl", "t/lib.pl"],
		  ["../tests/msql1.t", "t/msql1.t"],
		  ["../tests/msql2.t", "t/msql2.t"],
		  ["../tests/akmisc.t", "t/akmisc.t"]) {
	$pa .= _MY::Config::XtractF($ref, "~DRIVER~", "~DBD_DRIVER~",
				    "../xtract");
    }
    $pa;
}

