#!/usr/local/bin/perl -sw

use strict;
require ExtUtils::MakeMaker;
require Config;

sub config () {
    my $dbd_driver = "~DBD_DRIVER~";
    my $from_driver = "~DRIVER~";

    my $ref = &_MY::Config::Initialize~DRIVER~;

    my %hash = %$ref;
    $hash{'DEFINE'} .= " -DMyConnect=dbd_db_connect";
    $hash{'NAME'} = "DBD::" . $dbd_driver;
    $hash{'VERSION_FROM'} = "../lib/DBD/$dbd_driver.pm";
    if (-f 'dbimon') {
	$hash{'EXE_FILES'} = [ 'dbimon' ];
    }
    $hash{'clean'} = { 'FILES' => '*.xsi' };
    \%hash;
}


ExtUtils::MakeMaker::WriteMakefile(
	      OBJECT       => qq[\$(O_FILES)],
	      CONFIGURE    => \&config
	     );


sub MY::postamble {
    my $pa = "\n";
    my $ref;
    foreach $ref (@_MY::Config::Files::~DBD_DRIVER~) {
	my($from, $to) = @$ref;
	$from = "../$from";
	$to =~ s/DBD-~DBD_DRIVER~\///;
	$pa .= "$to: $from\n"
	    . "\tperl ../xtract $from $to ~DRIVER~ ~DBD_DRIVER~"
	    . " ~NODBD_VERSION~ ~DBD_VERSION~\n\n";
    }
    $pa = $pa . "\ndbd.xs: ~DBD_DRIVER~.xsi\n\n" . DBI::DBD::dbd_postamble();
}
